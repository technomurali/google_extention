<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Markdown Strip Test Suite</title>
  <style>
    body {
      font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
      max-width: 1200px;
      margin: 20px auto;
      padding: 0 20px;
      background: #1e1e1e;
      color: #d4d4d4;
    }
    h1 { color: #4ec9b0; }
    .test-case {
      background: #252526;
      border: 1px solid #3e3e42;
      border-radius: 6px;
      padding: 15px;
      margin: 15px 0;
    }
    .test-case.pass {
      border-left: 4px solid #4ec9b0;
    }
    .test-case.fail {
      border-left: 4px solid #f48771;
    }
    .test-header {
      font-weight: bold;
      margin-bottom: 10px;
      color: #569cd6;
    }
    .test-input, .test-expected, .test-actual {
      background: #1e1e1e;
      padding: 10px;
      margin: 8px 0;
      border-radius: 4px;
      font-family: 'Courier New', monospace;
      font-size: 13px;
      white-space: pre-wrap;
      word-break: break-word;
    }
    .label {
      display: inline-block;
      width: 100px;
      color: #9cdcfe;
      font-weight: bold;
    }
    .pass-badge {
      background: #4ec9b0;
      color: #000;
      padding: 2px 8px;
      border-radius: 3px;
      font-weight: bold;
      font-size: 12px;
    }
    .fail-badge {
      background: #f48771;
      color: #000;
      padding: 2px 8px;
      border-radius: 3px;
      font-weight: bold;
      font-size: 12px;
    }
    .summary {
      background: #252526;
      border: 2px solid #4ec9b0;
      border-radius: 6px;
      padding: 20px;
      margin: 20px 0;
      text-align: center;
      font-size: 18px;
    }
    .summary.fail {
      border-color: #f48771;
    }
  </style>
</head>
<body>
  <h1>üß™ Markdown Strip Test Suite</h1>
  <div id="results"></div>
  <div id="summary"></div>

  <script>
    /**
     * Strips all markdown formatting from text, returning plain text
     * Comprehensive function that handles all common markdown syntax
     */
    function stripMarkdown(text) {
      let result = String(text || '').trim();
      if (!result) return '';

      // 1. Remove code blocks (fenced with ``` or ~~~)
      result = result.replace(/```[\s\S]*?```/g, (match) => {
        // Extract content between backticks
        return match.replace(/```\w*\n?/g, '').replace(/```/g, '');
      });
      result = result.replace(/~~~[\s\S]*?~~~/g, (match) => {
        return match.replace(/~~~\w*\n?/g, '').replace(/~~~/g, '');
      });

      // 2. Remove inline code (single backticks)
      result = result.replace(/`([^`]+)`/g, '$1');

      // 3. Remove images ![alt](url)
      result = result.replace(/!\[([^\]]*)\]\([^\)]+\)/g, '$1');

      // 4. Remove links [text](url) - keep text
      result = result.replace(/\[([^\]]+)\]\([^\)]+\)/g, '$1');

      // 5. Remove reference-style links [text][ref]
      result = result.replace(/\[([^\]]+)\]\[[^\]]*\]/g, '$1');

      // 6. Remove reference definitions [ref]: url
      result = result.replace(/^\s*\[[^\]]+\]:\s+.+$/gm, '');

      // 7. Remove headers (# ## ### etc)
      result = result.replace(/^#{1,6}\s+(.+)$/gm, '$1');

      // 8. Remove bold (**text** or __text__)
      result = result.replace(/\*\*([^\*]+)\*\*/g, '$1');
      result = result.replace(/__([^_]+)__/g, '$1');

      // 9. Remove italic (*text* or _text_)
      result = result.replace(/\*([^\*]+)\*/g, '$1');
      result = result.replace(/_([^_]+)_/g, '$1');

      // 10. Remove strikethrough (~~text~~)
      result = result.replace(/~~([^~]+)~~/g, '$1');

      // 11. Remove blockquotes (> text)
      result = result.replace(/^>\s+(.+)$/gm, '$1');

      // 12. Remove unordered list markers (-, *, +)
      result = result.replace(/^\s*[-*+]\s+(.+)$/gm, '$1');

      // 13. Remove ordered list markers (1. 2. etc)
      result = result.replace(/^\s*\d+\.\s+(.+)$/gm, '$1');

      // 14. Remove task list markers (- [ ] or - [x])
      result = result.replace(/^\s*-\s+\[[x\s]\]\s+(.+)$/gim, '$1');

      // 15. Remove horizontal rules (---, ***, ___)
      result = result.replace(/^[\s]*[-*_]{3,}[\s]*$/gm, '');

      // 16. Remove HTML tags (basic strip)
      result = result.replace(/<[^>]+>/g, '');

      // 17. Clean up table syntax (basic - just remove pipes and dashes)
      result = result.replace(/^\s*\|(.+)\|\s*$/gm, '$1'); // Remove surrounding pipes
      result = result.replace(/\|/g, ' '); // Replace remaining pipes with spaces
      result = result.replace(/^[\s]*[-:]+[\s]*$/gm, ''); // Remove table separator lines

      // 18. Remove escape characters (\)
      result = result.replace(/\\([\\`*_{}[\]()#+\-.!|])/g, '$1');

      // 19. Clean up excessive whitespace
      result = result.replace(/\n{3,}/g, '\n\n'); // Max 2 newlines
      result = result.replace(/[ \t]+/g, ' '); // Collapse spaces/tabs
      result = result.replace(/^[ \t]+/gm, ''); // Remove leading whitespace per line
      result = result.replace(/[ \t]+$/gm, ''); // Remove trailing whitespace per line

      // 20. Final trim
      result = result.trim();

      return result;
    }

    // Test cases
    const tests = [
      {
        name: 'Headers',
        input: '# H1\n## H2\n### H3',
        expected: 'H1\nH2\nH3'
      },
      {
        name: 'Bold and Italic',
        input: '**bold** __bold__ *italic* _italic_',
        expected: 'bold bold italic italic'
      },
      {
        name: 'Links',
        input: '[Google](https://google.com) and [Link](url)',
        expected: 'Google and Link'
      },
      {
        name: 'Images',
        input: '![alt text](image.jpg)',
        expected: 'alt text'
      },
      {
        name: 'Code blocks',
        input: '```javascript\ncode\n```\nand `inline`',
        expected: 'code\nand inline'
      },
      {
        name: 'Lists (ordered and unordered)',
        input: '- item 1\n- item 2\n1. one\n2. two',
        expected: 'item 1\nitem 2\none\ntwo'
      },
      {
        name: 'Blockquotes',
        input: '> quote line 1\n> quote line 2',
        expected: 'quote line 1\nquote line 2'
      },
      {
        name: 'Horizontal rules',
        input: 'text\n---\nmore text\n***\nend',
        expected: 'text\nmore text\nend'
      },
      {
        name: 'Strikethrough',
        input: '~~deleted~~',
        expected: 'deleted'
      },
      {
        name: 'Tables',
        input: '| Col1 | Col2 |\n|------|------|\n| A | B |',
        expected: 'Col1 Col2\nA B'
      },
      {
        name: 'Task lists',
        input: '- [ ] todo\n- [x] done',
        expected: 'todo\ndone'
      },
      {
        name: 'Mixed complex',
        input: '# Title\n**Bold** and *italic*\n[Link](url)\n- list',
        expected: 'Title\nBold and italic\nLink\nlist'
      },
      {
        name: 'Nested formatting',
        input: '**bold with *italic* inside**',
        expected: 'bold with italic inside'
      },
      {
        name: 'HTML tags',
        input: '<div>content</div> <strong>bold</strong>',
        expected: 'content bold'
      },
      {
        name: 'Empty and whitespace',
        input: '  \n\n\ntext\n\n\n  ',
        expected: 'text'
      }
    ];

    // Run tests
    const resultsDiv = document.getElementById('results');
    const summaryDiv = document.getElementById('summary');
    let passed = 0;
    let failed = 0;

    tests.forEach((test, index) => {
      const actual = stripMarkdown(test.input);
      const pass = actual === test.expected;
      
      if (pass) passed++;
      else failed++;

      const testDiv = document.createElement('div');
      testDiv.className = `test-case ${pass ? 'pass' : 'fail'}`;
      testDiv.innerHTML = `
        <div class="test-header">
          Test ${index + 1}: ${test.name} 
          <span class="${pass ? 'pass-badge' : 'fail-badge'}">${pass ? 'PASS ‚úì' : 'FAIL ‚úó'}</span>
        </div>
        <div><span class="label">Input:</span><div class="test-input">${escapeHtml(test.input)}</div></div>
        <div><span class="label">Expected:</span><div class="test-expected">${escapeHtml(test.expected)}</div></div>
        <div><span class="label">Actual:</span><div class="test-actual">${escapeHtml(actual)}</div></div>
      `;
      resultsDiv.appendChild(testDiv);
    });

    // Summary
    const allPass = failed === 0;
    summaryDiv.className = `summary ${allPass ? '' : 'fail'}`;
    summaryDiv.innerHTML = `
      <strong>${allPass ? '‚úÖ All Tests Passed!' : '‚ö†Ô∏è Some Tests Failed'}</strong><br>
      Passed: ${passed} / ${tests.length}<br>
      Failed: ${failed} / ${tests.length}
    `;

    function escapeHtml(text) {
      const div = document.createElement('div');
      div.textContent = text;
      return div.innerHTML;
    }

    // Log for console inspection
    console.log('Test Results:', { passed, failed, total: tests.length });
    console.log('stripMarkdown function is available globally for manual testing');
    window.stripMarkdown = stripMarkdown;
  </script>
</body>
</html>

